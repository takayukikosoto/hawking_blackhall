# ç‰©ç†è¨ˆç®—ã®å®Ÿè£…è©³ç´°

## æ¦‚è¦

Hawking Radiation Simulator Proã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ç‰©ç†è¨ˆç®—ã®è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

## æ•°å€¤è¨ˆç®—æ‰‹æ³•ã®åˆ†é¡

æœ¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€å¤©ä½“ç‰©ç†å­¦ã§æ¨™æº–çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹æ•°å€¤è¨ˆç®—æ‰‹æ³•ã‚’çµ„ã¿åˆã‚ã›ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

### ä½¿ç”¨ã—ã¦ã„ã‚‹æ‰‹æ³•

| æ•°å€¤è¨ˆç®—æ³• | ç”¨é€” | å®Ÿè£…çŠ¶æ³ |
|-----------|------|---------|
| **ç²’å­æ³• (Particle Method)** | ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ”¾å°„ã®å¯è¦–åŒ– | âœ… å®Ÿè£…æ¸ˆã¿ |
| **å…‰ç·šè¿½è·¡æ³• (Ray Tracing)** | ãƒ•ã‚©ãƒˆãƒ³ã‚·ãƒ§ãƒƒãƒˆã®è»Œé“è¨ˆç®— | âœ… å®Ÿè£…æ¸ˆã¿ |
| **é™½è§£æ³• (Explicit Method)** | ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®ä½ç½®ãƒ»é€Ÿåº¦ã®æ™‚é–“ç™ºå±• | âœ… å®Ÿè£…æ¸ˆã¿ |
| **ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®ç°¡ç•¥åŒ–** | é‡åŠ›å ´ã®è¨ˆç®—ï¼ˆã‚½ãƒ•ãƒˆãƒ‹ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰ | âœ… å®Ÿè£…æ¸ˆã¿ |

### é–¢é€£ã™ã‚‹ï¼ˆå°†æ¥æ‹¡å¼µå¯èƒ½ãªï¼‰æ‰‹æ³•

| æ•°å€¤è¨ˆç®—æ³• | ç”¨é€” | å®Ÿè£…çŠ¶æ³ |
|-----------|------|---------|
| **è¼»å°„è¼¸é€ (Radiative Transfer)** | ã‚ˆã‚Šæ­£ç¢ºãªãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ”¾å°„ã®ã‚¹ãƒšã‚¯ãƒˆãƒ«è¨ˆç®— | ğŸ”¶ éƒ¨åˆ†çš„å®Ÿè£…ï¼ˆPython APIï¼‰ |
| **Treeæ³•** | å¤§é‡ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã«å¯¾ã™ã‚‹é«˜é€Ÿé‡åŠ›è¨ˆç®— | âŒ æœªå®Ÿè£…ï¼ˆç¾çŠ¶ã¯ç›´æ¥è¨ˆç®—ï¼‰ |
| **SPHæ³•** | æµä½“ã¨ã—ã¦ã®é™ç€å††ç›¤ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | âŒ æœªå®Ÿè£… |
| **FFT (PMæ³•, TreePMæ³•)** | é«˜é€Ÿãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã‚½ãƒ«ãƒãƒ¼ | âŒ æœªå®Ÿè£… |
| **ãƒãƒ«ãƒã‚°ãƒªãƒƒãƒ‰æ³•** | ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®é«˜ç²¾åº¦è§£æ³• | âŒ æœªå®Ÿè£… |

### å¤©ä½“ç‰©ç†å­¦ã¨ã®é–¢é€£

åŸå§‹æ˜Ÿåç¸®ã€BHé™ç€å††ç›¤ã€éŠ€æ²³å½¢æˆã€å¤ªé™½ç£å ´ãªã©ã®å¤©ä½“ç¾è±¡ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ”¯é…æ–¹ç¨‹å¼ã¨æ•°å€¤è¨ˆç®—æ³•ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼š

- **æ”¯é…æ–¹ç¨‹å¼**: æµä½“åŠ›å­¦ãƒ»ç£æ°—æµä½“åŠ›å­¦ã€ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã€ç²’å­ã®é‹å‹•æ–¹ç¨‹å¼ã€ç„¡è¡çªãƒœãƒ«ãƒ„ãƒãƒ³æ–¹ç¨‹å¼ã€è¼»å°„è¼¸é€ã€ç†±ä¼å°
- **æ•°å€¤è¨ˆç®—æ³•**: æ ¼å­æ³•ã€SPHæ³•ã€FFTã€Treeæ³•ã€ç²’å­æ³•ã€å…‰ç·šè¿½è·¡æ³•ã€é™°è§£æ³•ãƒ»é™½è§£æ³•

æœ¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚‚åŒæ§˜ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€ç‰¹ã«ï¼š
- **BHé™ç€å††ç›¤**ã«é–¢é€£ã™ã‚‹æ‰‹æ³•ï¼ˆè¼»å°„è¼¸é€ã€æµä½“åŠ›å­¦ï¼‰ã‚’éƒ¨åˆ†çš„ã«å®Ÿè£…
- **ç²’å­ã®é‹å‹•æ–¹ç¨‹å¼**ã‚’ç›´æ¥å®Ÿè£…ï¼ˆãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«å‘¨è¾ºã®è»Œé“è¨ˆç®—ï¼‰
- **å…‰ç·šè¿½è·¡æ³•**ã‚’å®Ÿè£…ï¼ˆãƒ•ã‚©ãƒˆãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼‰

## ç‰©ç†å®šæ•°

```javascript
// constants.js
G = 6.67430e-11      // é‡åŠ›å®šæ•° (mÂ³/kg/sÂ²)
c = 299792458        // å…‰é€Ÿ (m/s)
hbar = 1.054571817e-34 // æ›ç®—ãƒ—ãƒ©ãƒ³ã‚¯å®šæ•° (JÂ·s)
kB = 1.380649e-23    // ãƒœãƒ«ãƒ„ãƒãƒ³å®šæ•° (J/K)
M_sun = 1.98847e30    // å¤ªé™½è³ªé‡ (kg)
h = 6.62607015e-34   // ãƒ—ãƒ©ãƒ³ã‚¯å®šæ•° (JÂ·s)
```

## ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®ç‰©ç†é‡è¨ˆç®—

### ã‚·ãƒ¥ãƒ´ã‚¡ãƒ«ãƒ„ã‚·ãƒ«ãƒˆåŠå¾„

ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®äº‹è±¡ã®åœ°å¹³ç·šã®åŠå¾„ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

```javascript
// JavaScriptç‰ˆ (constants.js)
schwarzschildRadius(Mkg) {
  return 2 * G * Mkg / (c * c);
}
```

```python
# Pythonç‰ˆ (api/server.py)
def schwarzschild_radius(M_kg: float) -> float:
    """ã‚·ãƒ¥ãƒ´ã‚¡ãƒ«ãƒ„ã‚·ãƒ«ãƒˆåŠå¾„ã‚’è¨ˆç®—"""
    return 2 * G * M_kg / (c * c)
```

**ç‰©ç†å¼**: `r_s = 2GM/cÂ²`

- `M_kg`: ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®è³ªé‡ï¼ˆkgï¼‰
- è¿”ã‚Šå€¤: ã‚·ãƒ¥ãƒ´ã‚¡ãƒ«ãƒ„ã‚·ãƒ«ãƒˆåŠå¾„ï¼ˆmï¼‰

### ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ¸©åº¦

ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ãŒæ”¾å°„ã™ã‚‹æ¸©åº¦ã‚’è¨ˆç®—ã—ã¾ã™ã€‚ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ”¾å°„ã«ã‚ˆã‚Šã€ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®è³ªé‡ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒç²’å­ãƒšã‚¢ã¨ã—ã¦æ”¾å°„ã•ã‚Œã¾ã™ã€‚è³ªé‡ãŒå°ã•ã„ã»ã©é«˜æ¸©ã«ãªã‚Šã€ã‚ˆã‚Šå¤šãã®æ”¾å°„ã‚’æ”¾å‡ºã—ã¾ã™ã€‚

```javascript
// JavaScriptç‰ˆ (constants.js)
hawkingTemperature(Mkg) {
  return (hbar * Math.pow(c, 3)) / (8 * Math.PI * G * Mkg * kB);
}
```

```python
# Pythonç‰ˆ (api/server.py)
def hawking_temperature(M_kg: float) -> float:
    """ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ¸©åº¦ã‚’è¨ˆç®—"""
    return (hbar * (c ** 3)) / (8 * math.pi * G * M_kg * kB)
```

**ç‰©ç†å¼**: `T_H = (â„cÂ³)/(8Ï€GMk_B)`

- `M_kg`: ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®è³ªé‡ï¼ˆkgï¼‰
- è¿”ã‚Šå€¤: ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ¸©åº¦ï¼ˆKï¼‰

### ç›¸å¯¾çš„ãªæ”¾å°„ãƒ‘ãƒ¯ãƒ¼

å¤ªé™½è³ªé‡ã«å¯¾ã™ã‚‹ç›¸å¯¾çš„ãªãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ”¾å°„ãƒ‘ãƒ¯ãƒ¼ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

```javascript
// JavaScriptç‰ˆ (constants.js)
relativePowerVsSolar(Mkg) {
  const Ms = M_sun;
  return Math.pow(Ms / Mkg, 2);
}
```

```python
# Pythonç‰ˆ (api/server.py)
def relative_power_vs_solar(M_kg: float) -> float:
    """å¤ªé™½è³ªé‡ã«å¯¾ã™ã‚‹ç›¸å¯¾çš„ãªæ”¾å°„ãƒ‘ãƒ¯ãƒ¼ã‚’è¨ˆç®—"""
    return (M_sun / M_kg) ** 2
```

**ç‰©ç†å¼**: `P_rel = (M_â˜‰/M)Â²`

- è³ªé‡ãŒå°ã•ã„ã»ã©æ”¾å°„ãƒ‘ãƒ¯ãƒ¼ãŒå¤§ãããªã‚‹ï¼ˆé€†äºŒä¹—å‰‡ï¼‰
- ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ”¾å°„ã«ã‚ˆã‚Šã€ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®è³ªé‡ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒæ”¾å°„ã¨ã—ã¦å¤±ã‚ã‚Œã€è³ªé‡ãŒæ¸›å°‘ï¼ˆè’¸ç™ºï¼‰ã™ã‚‹
- å°ã•ãªãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã»ã©é€Ÿãè’¸ç™ºã™ã‚‹

### çµ¶å¯¾çš„ãªæ”¾å°„ãƒ‘ãƒ¯ãƒ¼ï¼ˆStefan-Boltzmannå‰‡ï¼‰

```python
# Pythonç‰ˆ (api/server.py)
def hawking_power_absolute(M_kg: float) -> float:
    """
    ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ”¾å°„ã®çµ¶å¯¾çš„ãªæ”¾å°„ãƒ‘ãƒ¯ãƒ¼ã‚’è¨ˆç®—ï¼ˆStefan-Boltzmannå‰‡ã‚’ä½¿ç”¨ï¼‰
    P = Ïƒ * A * T^4, where A = 4Ï€r_s^2
    """
    rs = schwarzschild_radius(M_kg)
    temp = hawking_temperature(M_kg)
    sigma = 5.670374419e-8  # Stefan-Boltzmann constant
    area = 4 * math.pi * rs * rs
    return sigma * area * (temp ** 4)
```

**ç‰©ç†å¼**: `P = ÏƒA T_Hâ´`, `A = 4Ï€r_sÂ²`

### Planckåˆ†å¸ƒã«ã‚ˆã‚‹ã‚¹ãƒšã‚¯ãƒˆãƒ«è¨ˆç®—

```python
# Pythonç‰ˆ (api/server.py)
def planck_spectrum(frequency_hz: float, temperature_K: float) -> float:
    """
    ãƒ—ãƒ©ãƒ³ã‚¯åˆ†å¸ƒã«ã‚ˆã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚¹ãƒšã‚¯ãƒˆãƒ«å¯†åº¦ã‚’è¨ˆç®—
    B_Î½(T) = (2hÎ½Â³/cÂ²) / (exp(hÎ½/kT) - 1)
    """
    nu = frequency_hz
    T = temperature_K
    
    exponent = (h * nu) / (kB * T)
    numerator = 2 * h * (nu ** 3) / (c ** 2)
    denominator = math.exp(exponent) - 1.0
    
    return numerator / denominator
```

**ç‰©ç†å¼**: `B_Î½(T) = (2hÎ½Â³/cÂ²) / (exp(hÎ½/kT) - 1)`

### ä¸€èˆ¬ç›¸å¯¾è«–çš„è£œæ­£ã‚’è€ƒæ…®ã—ãŸé‡åŠ›åŠ é€Ÿåº¦

```python
# Pythonç‰ˆ (api/server.py)
def gravitational_acceleration(r: float, M_kg: float, rs: float) -> float:
    """
    ä¸€èˆ¬ç›¸å¯¾è«–çš„åŠ¹æœã‚’è€ƒæ…®ã—ãŸé‡åŠ›åŠ é€Ÿåº¦ï¼ˆç°¡ç•¥ç‰ˆï¼‰
    Newton: a = -GM/rÂ²
    ç›¸å¯¾è«–çš„è£œæ­£ï¼ˆç°¡ç•¥ï¼‰: a â‰ˆ -GM/rÂ² * (1 + 3rs/r) for r >> rs
    """
    newtonian = -G * M_kg / (r * r)
    correction = 1.0 + 3.0 * rs / r if r > rs * 1.1 else 1.0
    return newtonian * correction
```

**ç‰©ç†å¼**: 
- ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³é‡åŠ›: `a = -GM/rÂ²`
- ç›¸å¯¾è«–çš„è£œæ­£: `a â‰ˆ -GM/rÂ² Ã— (1 + 3r_s/r)` (r >> r_s ã®è¿‘ä¼¼)

## ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç‰©ç†è¨ˆç®—

### é‡åŠ›åŠ é€Ÿåº¦ã®è¨ˆç®—

```javascript
// main.js - updateParticles()
const rsVisual = bhMesh.scale.x;
const soft = rsVisual * rsVisual * 0.4 + 0.04;  // ã‚½ãƒ•ãƒˆãƒ‹ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
const Gvis = 4.0 * rsVisual;                    // è¦–è¦šçš„ãªé‡åŠ›å®šæ•°

// ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã‹ã‚‰ã®è·é›¢
const r2 = x*x + y*y + z*z;
const r = Math.sqrt(r2) + 1e-6;

// é‡åŠ›åŠ é€Ÿåº¦ã®è¨ˆç®—
const accMag = -Gvis / (r2 + soft);
const invR = 1.0 / r;
const ax = accMag * x * invR;
const ay = accMag * y * invR;
const az = accMag * z * invR;
```

**ç‰©ç†å¼**: `a = -G_vis / (rÂ² + Îµ)`

- `G_vis`: è¦–è¦šçš„ãªé‡åŠ›å®šæ•°ï¼ˆ4.0 Ã— r_sï¼‰
- `soft`: ã‚½ãƒ•ãƒˆãƒ‹ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆç‰¹ç•°ç‚¹å›é¿ï¼‰
- `r`: ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã‹ã‚‰ã®è·é›¢

### é€Ÿåº¦ã®æ¸›è¡°ï¼ˆç¨®åˆ¥ã«å¿œã˜ã¦ï¼‰

```javascript
// main.js - updateParticles()
const sp = species[i];
const damping = (sp === 0) ? 0.998 :      // ãƒ•ã‚©ãƒˆãƒ³: 0.998
                (sp === 1) ? 0.9995 :     // ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒªãƒ: 0.9995
                              0.999;       // ã‚°ãƒ©ãƒ“ãƒˆãƒ³: 0.999

velocities[i3+0] *= damping;
velocities[i3+1] *= damping;
velocities[i3+2] *= damping;
```

å„ç²’å­ç¨®åˆ¥ã«å¿œã˜ãŸæ¸›è¡°ä¿‚æ•°ï¼š
- **ãƒ•ã‚©ãƒˆãƒ³ (Î³)**: 0.998ï¼ˆæœ€ã‚‚æ¸›è¡°ã—ã‚„ã™ã„ï¼‰
- **ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒªãƒ (Î½)**: 0.9995ï¼ˆä¸­ç¨‹åº¦ï¼‰
- **ã‚°ãƒ©ãƒ“ãƒˆãƒ³ (g)**: 0.999ï¼ˆæœ€ã‚‚æ¸›è¡°ã—ã«ãã„ï¼‰

### ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆç‡ã®è¨ˆç®—

```javascript
// main.js - spawnParticles()
const baseRate = 500.0;  // ãƒ™ãƒ¼ã‚¹ç”Ÿæˆç‡ï¼ˆãƒšã‚¢/ç§’ï¼‰
const rate = baseRate * rateUI * Math.max(0.01, relPower);
```

**ç‰©ç†å¼**: `rate = baseRate Ã— pairRateUI Ã— max(0.01, P_rel)`

- `baseRate`: 500.0 ãƒšã‚¢/ç§’
- `pairRateUI`: UIä¸Šã®ãƒšã‚¢ç”Ÿæˆç‡ï¼ˆ0.0-1.0ï¼‰
- `relPower`: ç›¸å¯¾çš„ãªæ”¾å°„ãƒ‘ãƒ¯ãƒ¼

## ãƒ•ã‚©ãƒˆãƒ³ã‚·ãƒ§ãƒƒãƒˆã®ç‰©ç†è¨ˆç®—

### å…‰ã®è»Œé“è¨ˆç®—ï¼ˆé‡åŠ›ãƒ¬ãƒ³ã‚ºåŠ¹æœï¼‰

```javascript
// main.js - createPhotonBeam()
let pos = startPos.clone();
let vel = direction.clone().normalize().multiplyScalar(stepSize * 150);

const rsVisual = bhMesh.scale.x;
const Gvis = 4.0 * rsVisual;
const soft = rsVisual * rsVisual * 0.4 + 0.04;

for (let i = 0; i < steps; i++) {
  const r2 = pos.x * pos.x + pos.y * pos.y + pos.z * pos.z;
  const r = Math.sqrt(r2) + 1e-6;
  
  // é‡åŠ›ã«ã‚ˆã‚‹æ›²ãŒã‚Š
  const accMag = -Gvis / (r2 + soft);
  const invR = 1.0 / r;
  const ax = accMag * pos.x * invR;
  const ay = accMag * pos.y * invR;
  const az = accMag * pos.z * invR;
  
  // é€Ÿåº¦ã®æ–¹å‘ã‚’æ›´æ–°ï¼ˆé‡åŠ›ã®å½±éŸ¿ï¼‰
  const pullStrength = 1.0 + (rsVisual / r) * 2.0;
  vel.x += ax * stepSize * 0.15 * pullStrength;
  vel.y += ay * stepSize * 0.15 * pullStrength;
  vel.z += az * stepSize * 0.15 * pullStrength;
  
  // é€Ÿåº¦ã‚’æ­£è¦åŒ–ï¼ˆå…‰é€Ÿã‚’ä¿ã¤ï¼‰
  vel.normalize().multiplyScalar(stepSize * 150);
  
  // ä½ç½®ã‚’æ›´æ–°
  pos.add(vel.clone().multiplyScalar(stepSize));
}
```

**ç‰©ç†å¼**: 
- é‡åŠ›åŠ é€Ÿåº¦: `a = -G_vis / (rÂ² + Îµ)`
- å¼•ãå¯„ã›å¼·åº¦: `pullStrength = 1 + 2r_s/r`
- å…‰é€Ÿã®ç¶­æŒ: `|v| = const`

### ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã¸ã®è½ä¸‹

```javascript
// main.js - createPhotonBeam()
// äº‹è±¡ã®åœ°å¹³ç·šã«åˆ°é”ã—ãŸã‚‰ã€ãã“ã‹ã‚‰å…ˆã¯å¸ã„è¾¼ã¾ã‚Œã‚‹
if (r < rsVisual * 1.05) {
  const toCenter = new THREE.Vector3(-pos.x, -pos.y, -pos.z).normalize();
  const fallSpeed = (rsVisual * 1.05 - r) * 5.0;
  
  // ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®ä¸­å¿ƒã«å‘ã‹ã£ã¦å¸ã„è¾¼ã¾ã‚Œã‚‹æ§˜å­ã‚’è¡¨ç¾
  for (let fall = 0; fall < 10; fall++) {
    pos.add(toCenter.clone().multiplyScalar(fallSpeed * 0.1));
    // ...
  }
}
```

äº‹è±¡ã®åœ°å¹³ç·šï¼ˆ`r < 1.05 Ã— r_s`ï¼‰ã‚’è¶…ãˆã‚‹ã¨ã€ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã®ä¸­å¿ƒã«å‘ã‹ã£ã¦åŠ é€Ÿçš„ã«è½ä¸‹ã—ã¾ã™ã€‚

## ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®çµ±è¨ˆçš„åˆ†å¸ƒ

### Gamma(4)åˆ†å¸ƒã«ã‚ˆã‚‹ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°

```javascript
// constants.js
sampleXGamma4(rand01) {
  let x = 0;
  for(let i=0; i<4; i++) {
    const u = Math.max(1e-12, rand01());
    x += -Math.log(u);
  }
  return x; // mean 4
}
```

**ç‰©ç†çš„æ„å‘³**: é»’ä½“æ”¾å°„ã® `xÂ³/(exp(x)-1)` ã®è¿‘ä¼¼ã¨ã—ã¦ã€4ã¤ã®æŒ‡æ•°åˆ†å¸ƒã®å’Œï¼ˆErlangåˆ†å¸ƒï¼‰ã‚’ä½¿ç”¨ã€‚

### ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‹ã‚‰RGBã¸ã®å¤‰æ›

```javascript
// constants.js
energyToRgb(E) {
  const lambda = (h * c) / E;  // æ³¢é•·ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰
  const nm = lambda * 1e9;     // ãƒŠãƒãƒ¡ãƒ¼ãƒˆãƒ«
  
  // å¯è¦–å…‰ç¯„å›²ï¼ˆ380-700nmï¼‰ã«ã‚¯ãƒ©ãƒ³ãƒ—
  const L = Math.max(380, Math.min(700, nm));
  
  // ç°¡æ˜“çš„ãªCIEè‰²ç©ºé–“ã‹ã‚‰RGBã¸ã®å¤‰æ›
  // ...
}
```

**ç‰©ç†å¼**: `Î» = hc/E`

## é‡åŠ›ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ãƒ¡ãƒƒã‚·ãƒ¥

```javascript
// main.js - createGravityWellMesh()
const potential = -1.0 / (r_from_bh + rsVisual * 0.5);
const height = potential * 8.0; // è¦–è¦šçš„ãªã‚¹ã‚±ãƒ¼ãƒ«
```

**ç‰©ç†å¼**: `Ï† = -1/r`ï¼ˆç°¡ç•¥åŒ–ã•ã‚ŒãŸé‡åŠ›ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ï¼‰

3Dãƒ¡ãƒƒã‚·ãƒ¥ã§é‡åŠ›ã®äº•æˆ¸ã‚’å¯è¦–åŒ–ã—ã¦ã„ã¾ã™ã€‚

## æ™‚ç©ºã®æ­ªã¿ã‚°ãƒªãƒƒãƒ‰

```javascript
// main.js - createSpacetimeGrid()
const potential = -1.0 / (r + rsVisual * 0.5);
const z = potential * 3.0; // zæ–¹å‘ã®å¤‰ä½
```

é‡åŠ›ã«ã‚ˆã‚‹ç©ºé–“ã®æ­ªã¿ã‚’ã€ã‚°ãƒªãƒƒãƒ‰ã®zæ–¹å‘å¤‰ä½ã¨ã—ã¦è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚

## Python APIã®é«˜åº¦ãªè¨ˆç®—

Python APIã§ã¯ã€JavaScriptã§ã¯å›°é›£ãªè¨ˆç®—ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚è¨ˆç®—è³‡æºã®ç¯„å›²å†…ã§å®Ÿè£…å¯èƒ½ãªæ‰‹æ³•ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### æ•°å€¤ç©åˆ†ã«ã‚ˆã‚‹ç·ãƒ‘ãƒ¯ãƒ¼è¨ˆç®—

```python
# api/server.py
def total_hawking_power_numerical(M_kg: float, frequency_range: tuple = (1e10, 1e30)) -> float:
    """
    æ•°å€¤ç©åˆ†ã‚’ä½¿ç”¨ã—ã¦ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ”¾å°„ã®ç·ãƒ‘ãƒ¯ãƒ¼ã‚’è¨ˆç®—
    ã‚ˆã‚Šæ­£ç¢ºãªè¨ˆç®—ï¼ˆPlanckåˆ†å¸ƒã®ç©åˆ†ï¼‰
    """
    temp = hawking_temperature(M_kg)
    
    def integrand(nu):
        return planck_spectrum(nu, temp) * math.pi
    
    result, _ = integrate.quad(integrand, frequency_range[0], frequency_range[1], limit=1000)
    return result
```

SciPyã®æ•°å€¤ç©åˆ†ã‚’ä½¿ç”¨ã—ã¦ã€Planckåˆ†å¸ƒã®å…¨å‘¨æ³¢æ•°ã«ã‚ãŸã‚‹ç©åˆ†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

### Nä½“å•é¡Œã®ã‚½ãƒ«ãƒãƒ¼ï¼ˆTreeæ³•ã®ç°¡ç•¥ç‰ˆï¼‰

å¤§é‡ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã«å¯¾ã™ã‚‹é«˜é€Ÿé‡åŠ›è¨ˆç®—ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```python
# api/physics_advanced.py
class NBodySolver:
    def calculate_gravity_tree(self, particles, bh_mass, bh_pos=(0,0,0)):
        """
        Treeæ³•ã‚’ä½¿ç”¨ã—ãŸé‡åŠ›è¨ˆç®—ï¼ˆç°¡ç•¥ç‰ˆï¼‰
        - ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã‹ã‚‰ã®é‡åŠ›ã‚’ä¸»è¦é …ã¨ã—ã¦è¨ˆç®—
        - ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«é–“ã®ç›¸äº’ä½œç”¨ã¯è¿‘å‚ã®ã¿è€ƒæ…®ï¼ˆTreeæ³•ã®ç°¡ç•¥ç‰ˆï¼‰
        """
```

**è¨ˆç®—é‡**: O(NÂ²) â†’ O(N log N)ï¼ˆå®Œå…¨ãªTreeæ³•ã§ã¯ï¼‰ã®ç°¡ç•¥ç‰ˆ
- å®Ÿéš›ã®Barnes-Hut Treeæ³•ã§ã¯éšå±¤æ§‹é€ ã‚’ä½¿ã†ãŒã€ã“ã“ã§ã¯è·é›¢é–¾å€¤ã‚’ä½¿ç”¨
- è¨ˆç®—è³‡æºã®ç¯„å›²å†…ã§å®Ÿè£…å¯èƒ½

### SPHæ³•ï¼ˆSmoothed Particle Hydrodynamicsï¼‰

æµä½“ã¨ã—ã¦ã®é™ç€å††ç›¤ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```python
# api/physics_advanced.py
class SPHSimulator:
    def calculate_density(self, particles):
        """
        SPHæ³•ã«ã‚ˆã‚‹å¯†åº¦è¨ˆç®—
        - Cubic Splineã‚«ãƒ¼ãƒãƒ«é–¢æ•°ã‚’ä½¿ç”¨
        - å„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®å¯†åº¦ã‚’è¿‘å‚ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‹ã‚‰è¨ˆç®—
        """
```

**ç”¨é€”**: é™ç€å††ç›¤ã®æµä½“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥æ‹¡å¼µç”¨ï¼‰

### è¼»å°„è¼¸é€ï¼ˆFLDæ³•ï¼‰

Flux-Limited Diffusion (FLD) è¿‘ä¼¼ã«ã‚ˆã‚‹è¼»å°„ãƒ•ãƒ©ãƒƒã‚¯ã‚¹è¨ˆç®—ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```python
# api/physics_advanced.py
class RadiativeTransfer:
    def flux_limited_diffusion(self, temperature, density, opacity):
        """
        FLDæ³•ã«ã‚ˆã‚‹è¼»å°„ãƒ•ãƒ©ãƒƒã‚¯ã‚¹è¨ˆç®—
        - å…‰å­¦çš„ã«è–„ã„å ´åˆ: Stefan-Boltzmannå‰‡
        - å…‰å­¦çš„ã«åšã„å ´åˆ: æ‹¡æ•£è¿‘ä¼¼
        """
```

**ç”¨é€”**: ã‚ˆã‚Šæ­£ç¢ºãªãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ”¾å°„ã®ã‚¹ãƒšã‚¯ãƒˆãƒ«è¨ˆç®—

### ã‚ˆã‚Šæ­£ç¢ºãªãƒ•ã‚©ãƒˆãƒ³è»Œé“è¨ˆç®—ï¼ˆä¸€èˆ¬ç›¸å¯¾è«–çš„ï¼‰

ä¸€èˆ¬ç›¸å¯¾è«–çš„åŠ¹æœã‚’è€ƒæ…®ã—ãŸãƒ•ã‚©ãƒˆãƒ³è»Œé“è¨ˆç®—ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```python
# api/physics_advanced.py
def calculate_photon_trajectory_relativistic(
    start_pos, direction, bh_mass, steps=500, step_size=0.1
):
    """
    ã‚·ãƒ¥ãƒ´ã‚¡ãƒ«ãƒ„ã‚·ãƒ«ãƒˆè§£ã§ã®æ¸¬åœ°ç·šæ–¹ç¨‹å¼ï¼ˆç°¡ç•¥ç‰ˆï¼‰
    - ãƒ¡ãƒˆãƒªãƒƒã‚¯ãƒ†ãƒ³ã‚½ãƒ«ã‹ã‚‰è¨ˆç®—ï¼ˆç°¡ç•¥åŒ–ï¼‰
    - å¼·ã„é‡åŠ›å ´ã§ã®è£œæ­£ã‚’è€ƒæ…®
    """
```

**ç”¨é€”**: ã‚ˆã‚Šæ­£ç¢ºãªé‡åŠ›ãƒ¬ãƒ³ã‚ºåŠ¹æœã®è¨ˆç®—

### è»Œé“ç©åˆ†å™¨ï¼ˆRKæ³•ï¼‰

ã‚ˆã‚Šæ­£ç¢ºãªæ™‚é–“ç™ºå±•ã®ãŸã‚ã®ç©åˆ†å™¨ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```python
# api/physics_advanced.py
class OrbitalIntegrator:
    def __init__(self, method='rk4'):
        """
        ç©åˆ†æ‰‹æ³•: 'euler', 'rk2', 'rk4'
        - ã‚ªã‚¤ãƒ©ãƒ¼æ³•: 1æ¬¡ç²¾åº¦
        - 2æ¬¡ãƒ«ãƒ³ã‚²ãƒ»ã‚¯ãƒƒã‚¿æ³•: 2æ¬¡ç²¾åº¦
        - 4æ¬¡ãƒ«ãƒ³ã‚²ãƒ»ã‚¯ãƒƒã‚¿æ³•: 4æ¬¡ç²¾åº¦ï¼ˆç°¡ç•¥ç‰ˆï¼‰
        """
```

**ç”¨é€”**: ã‚ˆã‚Šæ­£ç¢ºãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®è»Œé“è¨ˆç®—

### ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®çµ±è¨ˆçš„åˆ†å¸ƒã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°

```python
# api/server.py
def energy_distribution_sample(temperature_K: float, num_samples: int = 1000) -> List[float]:
    """
    ãƒ›ãƒ¼ã‚­ãƒ³ã‚°æ¸©åº¦ã«åŸºã¥ãã‚¨ãƒãƒ«ã‚®ãƒ¼ã®çµ±è¨ˆçš„åˆ†å¸ƒã‚’è¨ˆç®—
    ã‚ˆã‚Šæ­£ç¢ºãªã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†å¸ƒã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    """
    kT = kB * temperature_K
    # Planckåˆ†å¸ƒã‹ã‚‰ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼ˆé€†å¤‰æ›ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã®è¿‘ä¼¼ï¼‰
    # ...
```

Planckåˆ†å¸ƒã«åŸºã¥ãã€ã‚ˆã‚Šæ­£ç¢ºãªã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†å¸ƒã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

## è¦–è¦šåŒ–ã®ãŸã‚ã®ç°¡ç•¥åŒ–

å®Ÿéš›ã®ç‰©ç†è¨ˆç®—ã§ã¯ã€ä»¥ä¸‹ã®ç°¡ç•¥åŒ–ã‚’è¡Œã£ã¦ã„ã¾ã™ï¼š

1. **ã‚½ãƒ•ãƒˆãƒ‹ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: é‡åŠ›è¨ˆç®—ã®ç‰¹ç•°ç‚¹å›é¿ã®ãŸã‚ `soft = r_sÂ² Ã— 0.4 + 0.04`
2. **è¦–è¦šçš„ãªé‡åŠ›å®šæ•°**: `G_vis = 4.0 Ã— r_s`ï¼ˆå®Ÿéš›ã®Gã¨ã¯ç•°ãªã‚‹ï¼‰
3. **æ¸›è¡°ä¿‚æ•°**: ç²’å­ç¨®åˆ¥ã«å¿œã˜ãŸçµŒé¨“çš„ãªæ¸›è¡°ï¼ˆ0.998-0.999ï¼‰
4. **å…‰é€Ÿã®è¿‘ä¼¼**: ãƒ•ã‚©ãƒˆãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ã¯ `v â‰ˆ 150 Ã— stepSize` ã¨ã—ã¦æ‰±ã†

## å‚è€ƒæ–‡çŒ®

- Hawking, S. W. (1974). "Black hole explosions?". Nature 248 (5443): 30â€“31.
- Schwarzschild, K. (1916). "Ãœber das Gravitationsfeld eines Massenpunktes nach der Einsteinschen Theorie". Sitzungsberichte der KÃ¶niglich Preussischen Akademie der Wissenschaften. 7: 189â€“196.

